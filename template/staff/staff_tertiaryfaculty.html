{% extends "staff/staff_template.html" %}
{% load static %}

{% block title %}Tertiary Faculty{% endblock %}

{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/accounts.css' %}">
{% endblock %}

{% block maincontents %}
<div class="accounts-container">
    <h2>Tertiary Faculty</h2>

    <!-- Filters and Search -->
    <div class="accounts-header">
        <select id="departmentFilter" onchange="filterByDepartment()">
            <option value="">All Departments</option>
            <option value="information technology">Information Technology</option>
            <option value="tourism">Tourism</option>
            <option value="business administration">Business Administration</option>
            <option value="criminology">Criminology</option>
            <option value="basic education">Basic Education</option>
        </select>

        <div class="search-container">
            <input type="text" class="search-input" id="searchInput" placeholder="Search accounts..."
                onkeyup="searchTable()">
            <button class="search-btn" onclick="searchTable()">
                <span class="material-symbols-outlined">search</span>
            </button>
        </div>
        <button class="add-teacher-btn" onclick="openModal()">
            <span class="material-symbols-outlined" style="font-size: 16px; margin-right: 5px;">add</span>
            Add User
        </button>
    </div>

    <!-- Faculty Table -->
    <div class="accounts-table">
        <table id="accountsTable">
            <thead>
                <tr>
                    <th>Employee ID</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Employment Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for professor in professors %}
                <tr data-professor-id="{{ professor.id }}" data-user-type="{{ professor.user_type }}"
                    data-first-name="{{ professor.firstName }}" data-mid-name="{{ professor.midName }}"
                    data-last-name="{{ professor.lastName }}" data-department="{{ professor.department }}"
                    data-employment-status="{{ professor.employmentStatus }}" data-employ-id="{{ professor.employID }}">
                    <td class="employID">{{professor.employID}}</td>
                    <td class="user_name">{{ professor.full_name }}</td>
                    <td class="user-department">{{ professor.department }}</td>
                    <td class="user-employ-status">{{ professor.employmentstatus|default:"Full-time" }}</td>
                    <td class="actions">
                        <button title="Reset-password"
                            onclick="resetPassword('{{professor.id}}', '{{professor.email}}', '{{professor.user_type}}')">
                            <span class="material-symbols-outlined">lock</span>
                        </button>
                        <button title="Edit-info" class="edit-btn-action">
                            <span class="material-symbols-outlined">edit</span>
                        </button>
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="6">No users found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="modal" id="teacherModal">
        <div class="modal-content">
            <h3>Register User</h3>

            <label for="user-type"><span style="color: red;">* </span> User Type:</label>
            <select required id="user-type" onchange="toggleUserTypeFields()">
                <option value="TertiaryFaculty" selected>Tertiary Faculty</option>
            </select>

            <label for="employID"><span style="color: red;">* </span> Employee ID</label>
            <input required type="text" id="employID" placeholder="Enter employee ID" maxlength="8" minlength="8">

            <label for="teacherEmail"><span style="color: red;">* </span> Email Address</label>
            <input required type="email" id="teacherEmail" placeholder="Enter email address">

            <label for="teacherFirst"><span style="color: red;">* </span> First Name</label>
            <input required type="text" id="teacherFirst" placeholder="Enter first name">

            <label for="teacherMiddle">Middle Name (Optional)</label>
            <input type="text" id="teacherMiddle" placeholder="Enter middle name">

            <label for="teacherLast"><span style="color: red;">* </span>Last Name </label>
            <input required type="text" id="teacherLast" placeholder="Enter last name">

            <label for="teacherContact"><span style="color: red;">*</span>Contact Number</label>
            <input required type="tel" id="teacherContact" placeholder="Enter contact number" maxlength="11"
                pattern="[0-9]{11}" title="Please enter exactly 11 digits">
            <div id="facultyFields" style="display: none;">
                <label for="teacherDept"><span style="color: red;">* </span>Department</label>
                <select required id="teacherDept">
                    <option value="" disabled selected>Select Department</option>
                    <option value="Information Technology">Information Technology</option>
                    <option value="Criminology">Criminology</option>
                    <option value="Business Administration">Business Administration</option>
                    <option value="Tourism Management">Tourism Management</option>
                    <option value="Basic Education">Basic Education</option>
                </select>
                <label for="employmentStatus"><span style="color: red;">* </span>Employment Status</label>
                <select id="employmentStatus">
                    <option value="" disabled selected>Select Status</option>
                    <option value="Regular">Regular</option>
                    <option value="Full-time">Full-time</option>
                    <option value="Part-time">Part-time</option>
                </select>

            </div>
            <div class="modal-actions">
                <button class="cancel-btn" onclick="closeModal()">Cancel</button>
                <button class="save-btn" onclick="saveTeacher()">Add User</button>
            </div>
            <div style="margin-bottom: 20px;">

            </div>
        </div>
    </div>
    <!-- Edit User Modal -->
    <div class="modal" id="editTeacherModal">
        <div class="modal-content">
            <h3>Edit User Information</h3>

            <input type="hidden" id="editTeacherId">
            <input type="hidden" id="editUserType">

            <label for="editTeacherFirst">First Name <span style="color: red;">*</span></label>
            <input required type="text" id="editTeacherFirst" placeholder="Enter first name">

            <label for="editTeacherMiddle">Middle Name (Optional)</label>
            <input type="text" id="editTeacherMiddle" placeholder="Enter middle name">

            <label for="editTeacherLast">Last Name <span style="color: red;">*</span></label>
            <input required type="text" id="editTeacherLast" placeholder="Enter last name">

            <label for="editTeacherEmail">Email Address<span style="color: red;">*</span></label>
            <input required type="email" id="editTeacherEmail" placeholder="Enter email address" readonly
                style="background-color: #f0f0f0; cursor: not-allowed;">

            <label for="editTeacherContact">Contact Number <span style="color: red;">*</span></label>
            <input required type="tel" id="editTeacherContact" placeholder="Enter contact number" minlength="11"
                maxlength="11" pattern="[0-9]{11}" title="Please enter exactly 11 digits">

            <label for="editTeacherDept">Department <span style="color: red;">*</span></label>
            <select required id="editTeacherDept">
                <option value="" disabled>Select Department</option>
                <option value="Information Technology">Information Technology</option>
                <option value="Criminology">Criminology</option>
                <option value="Business Administration">Business Administration</option>
                <option value="Tourism Management">Tourism Management</option>
                <option value="Basic Education">Basic Education</option>
            </select>

            <!-- Fields for Tertiary Faculty Only -->
            <div id="editFacultyFields" style="display: none;">
                <label for="editEmploymentStatus">Employment Status <span style="color: red;">*</span></label>
                <select id="editEmploymentStatus">
                    <option value="" disabled>Select Status</option>
                    <option value="Full-time">Full-time</option>
                    <option value="Part-time">Part-time</option>
                </select>

                <label for="editEmployID">Employee ID <span style="color: red;">*</span></label>
                <input type="text" id="editEmployID" placeholder="Enter employee ID" maxlength="8" minlength="8">
            </div>

            <!-- Fields for System Users Only -->
            <div id="editSystemUserFields" style="display: none;">
                <label for="editUserRole">User Role <span style="color: red;">*</span></label>
                <select id="editUserRole">
                    <option value="staff/checker">Staff/Checker</option>
                    <option value="admin">Admin</option>
                </select>
            </div>

            <div class="modal-actions">
                <button class="cancel-btn" onclick="closeEditModal()">Cancel</button>
                <button class="save-btn" onclick="updateTeacher()">Update User</button>
            </div>
        </div>
    </div>
    <script src="{% static 'js/staff_tertiary_faculty.js' %}"></script>
    {% endblock %}